<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<!--PM's doc requirements: 
 *  Server based automounting of home directories 
       1.Configuration and usage description (m)
       2.Firewall configuration for SMB support (m)
       3.Kerberos support description (d)
 
 This is related to #300967: Mount Server Home Directory Automatically with
 Authentication.  Everything that's being done there to ensure that the users
 will be able to access their home directories when hosted on CIFS.

 2010-09-02, ke: feature is available in yast2-samba-client.  Also see
 security_ad_support.xml
 Now mentioned in id="sec.samba.client.inst.yast"

-->
<chapter id="cha.samba">
 <title>Samba</title><indexterm id="idx.Samba" class="startofrange">
 <primary>Samba</primary></indexterm><indexterm>
 <primary>SMB</primary>
 <see>Samba</see></indexterm><indexterm>
 <primary>Mac OS X</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>Windows</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>OS/2</primary>
 <secondary>sharing files</secondary></indexterm><indexterm>
 <primary>Linux</primary>
 <secondary>sharing files with another OS</secondary></indexterm>
 <abstract>
<!-- FIXME: do we still provide SWAT? -->
  <para>
   Using Samba, a Unix machine can be configured as a file and print server
   for Mac OS X, Windows, and OS/2 machines. Samba has developed into a
   fully-fledged and rather complex product. Configure Samba with &yast;,
   SWAT (a Web interface), or by editing the configuration file manually.
  </para>
 </abstract>
 <sect1 id="sec.samba.term">
  <title>Terminology</title>

  <para>
   The following are some terms used in Samba documentation and in the
   &yast; module.
  </para>

  <variablelist>
   <varlistentry>
    <term>SMB protocol</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>SMB</secondary>
      </indexterm> <indexterm>
      <primary>protocols</primary>
      <secondary>SMB</secondary>
      </indexterm> <indexterm>
      <primary>smbd</primary>
      </indexterm> Samba uses the SMB (server message block) protocol that
      is based on the <productname>NetBIOS</productname> services. Microsoft
      released the protocol so other software manufacturers could establish
      connections to a Microsoft domain network. With Samba, the SMB
      protocol works on top of the TCP/IP protocol, so the TCP/IP protocol
      must be installed on all clients. <indexterm>
      <primary>Samba</primary>
      <secondary>TCP/IP and</secondary>
      </indexterm>
     </para>
     <tip arch="zseries" os="sles">
      <title>IBM &zseries;: NetBIOS Support</title>
      <para>
       IBM &zseries; merely supports SMB over TCP/IP. NetBIOS support is not
       available on these systems.
      </para>
     </tip>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CIFS protocol</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>CIFS</secondary>
      </indexterm> <indexterm>
      <primary>protocols</primary>
      <secondary>CIFS</secondary>
      </indexterm> CIFS (common Internet file system) protocol is another
      protocol supported by Samba. CIFS defines a standard remote file
      system access protocol for use over the network, enabling groups of
      users to work together and share documents across the network.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>NetBIOS</term>
    <listitem>
     <para>
      <indexterm>
      <primary>NetBIOS</primary>
      </indexterm> NetBIOS is a software interface (API) designed for
      communication between machines providing a name service. It enables
      machines connected to the network to reserve names for themselves.
      After reservation, these machines can be addressed by name. There is
      no central process that checks names. Any machine on the network can
      reserve as many names as it wants as long as the names are not already
      in use. The NetBIOS interface can be implemented for different network
      architectures. An implementation that works relatively closely with
      network hardware is called <productname>NetBEUI</productname>, but
      this is often referred to as <productname>NetBIOS</productname>.
      Network protocols implemented with NetBIOS are IPX from Novell
      (NetBIOS via TCP/IP) and TCP/IP.
     </para>
     <para>
      The NetBIOS names sent via TCP/IP have nothing in common with the
      names used in <filename>/etc/hosts</filename> or those defined by DNS.
      NetBIOS uses its own, completely independent naming convention.
      However, it is recommended to use names that correspond to DNS
      hostnames to make administration easier or use DNS natively. This is
      the default used by Samba.
     </para><indexterm>
     <primary>Samba</primary>
     <secondary>names</secondary></indexterm>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba server</term>
    <listitem><indexterm>
     <primary>Samba</primary>
     <secondary>server</secondary></indexterm>
     <para>
      Samba server provides SMB/CIFS services and NetBIOS over IP naming
      services to clients. For Linux, there are three daemons for Samba
      server: smbd for SMB/CIFS services, nmbd for naming services, and
      winbind for authentication.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Samba client</term>
    <listitem><indexterm id="idx.Samba_clients" class="startofrange">
     <primary>Samba</primary>
     <secondary>clients</secondary></indexterm>
     <para>
      The Samba client is a system that uses Samba services from a Samba
      server over the SMB protocol. All common operating systems, such as
      Mac OS X, Windows, and OS/2, support the SMB protocol. The TCP/IP
      protocol must be installed on all computers. Samba provides a client
      for the different UNIX flavors. For Linux, there is a kernel module
      for SMB that allows the integration of SMB resources on the Linux
      system level. You do not need to run any daemon for the Samba client.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Shares</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>shares</secondary>
      </indexterm> SMB servers provide resources to the clients by means of
      shares. Shares are printers and directories with their subdirectories
      on the server. It is exported by means of a name and can be accessed
      by its name. The share name can be set to any name&mdash;it does not
      have to be the name of the export directory. A printer is also
      assigned a name. Clients can access the printer by its name.
      <indexterm>
      <primary>printing</primary>
      <secondary>Samba</secondary>
      </indexterm> <indexterm>
      <primary>Samba</primary>
      <secondary>printers</secondary>
      </indexterm>
      <indexterm class="endofrange" startref="idx.Samba_clients"/>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>DC</term>
    <listitem>
     <para>
      <indexterm>
      <primary>Samba</primary>
      <secondary>DC</secondary>
      </indexterm> A domain controller (DC) is a server that handles
      accounts in domain. For data replication, additional domain
      controllers are available in one domain.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 id="sec.samba.install" os="osuse">
  <title>Installing a Samba Server</title>

  <para>
   To install a Samba server, start &yast; and select
   <menuchoice><guimenu>Software</guimenu> <guimenu>Software
   Management</guimenu></menuchoice>. Choose
   <menuchoice><guimenu>Filter</guimenu>
   <guimenu>Patterns</guimenu></menuchoice> and select <guimenu>File
   Server</guimenu>. Confirm the installation of the required packages to
   finish the installation process.
  </para>
 </sect1>
 <sect1 id="sec.samba.serv.start" os="osuse;sles">
  <title>Starting and Stopping Samba</title>

  <para>
   You can start or stop the Samba server automatically (during boot) or
   manually. Starting and stopping policy is a part of the &yast; Samba
   server configuration described in
   <xref
    linkend="sec.samba.yast2.conf"/>.
  </para>

  <para>
   To stop or start running Samba services with &yast;, use <menuchoice>
   <guimenu>System</guimenu> <guimenu>System Services (Runlevel)</guimenu>
   </menuchoice> and check winbind, smb, and nmb. From a command line, stop
   services required for Samba with <command>rcsmb stop &amp;&amp; rcnmb
   stop</command> and start them with <command>rcnmb start &amp;&amp; rcsmb
   start</command>; rcsmb cares about winbind if needed.
  </para><indexterm>

  <primary>Samba</primary>

  <secondary>starting</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>stopping</secondary></indexterm>
 </sect1>
 <sect1 id="sec.samba.serv.inst">
  <title>Configuring a Samba Server</title><indexterm>

  <primary>Samba</primary>

  <secondary>installing</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>servers</secondary></indexterm><indexterm>

  <primary>Samba</primary>

  <secondary>configuring</secondary></indexterm><indexterm>

  <primary>configuring</primary>

  <secondary>Samba</secondary></indexterm>

  <para os="osuse;sles">
   A Samba server in &productnamereg; can be configured in two different
   ways: with &yast; or manually. Manual configuration offers a higher level
   of detail, but lacks the convenience of the &yast; GUI.
  </para>

  <para os="sled">
   For configuring a Samba server, see the &sls; documentation.
  </para>

  <sect2 id="sec.samba.yast2.conf" os="osuse;sles">
   <title>Configuring a Samba Server with &yast;</title>
   <para>
    To configure a Samba server, start &yast; and select
    <menuchoice><guimenu>Network Services</guimenu><guimenu>Samba
    Server</guimenu></menuchoice>.
   </para>
   <sect3 id="sec.samba.yast2.conf.inst">
    <title>Initial Samba Configuration</title>
    <para>
     When starting the module for the first time, the <guimenu>Samba
     Installation</guimenu> dialog starts, prompting you to make just a few
     basic decisions concerning administration of the server. At the end of
     the configuration it prompts for the Samba administrator password
     (<guimenu>Samba Root Password</guimenu>. For later starts, the
     <guimenu>Samba Server Configuration</guimenu> dialog appears.
    </para>
    <para>
     The <guimenu>Samba Installation</guimenu> dialog consists of two steps
     and optional detailed settings:
    </para>
    <variablelist>
     <varlistentry>
      <term>Workgroup or Domain Name</term>
      <listitem>
       <para>
        Select an existing name from <guimenu>Workgroup or Domain
        Name</guimenu> or enter a new one and click <guimenu>Next</guimenu>.
       </para>
<!--<figure id="fig.yast2.samba.startup">
      <title>Samba Configuration&mdash;Workgroup or
      Domain 
      Name</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_workgroup.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_workgroup.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>-->
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Samba Server Type</term>
      <listitem>
       <para>
        In the next step, specify whether your server should act as CD (PDC)
        and click <guimenu>Next</guimenu>.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Start-Up</term>
      <listitem>
       <para>
        Select whether you want to start Samba <guimenu>During
        Boot</guimenu> or <guimenu>Manually</guimenu> and click
        <guimenu>OK</guimenu>. Then in the final pop-up box, set the
        <guimenu>Samba root Password</guimenu>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     You can change all settings later in the <guimenu>Samba
     Configuration</guimenu> dialog with the <guimenu>Start-Up</guimenu>,
     <guimenu>Shares</guimenu>, <guimenu>Identity</guimenu>,
     <guimenu>Trusted Domains</guimenu>, and <guimenu>LDAP
     Settings</guimenu> tabs.
    </para>
   </sect3>
   <sect3 id="sec.samba.yast2.conf.adv">
    <title>Advanced Samba Configuration</title>
    <para>
     During the first start of the Samba server module the <guimenu>Samba
     Configuration</guimenu> dialog appears directly after the two initial
     steps described in <xref linkend="sec.samba.yast2.conf.inst"/>. Use it
     to adjust your Samba server configuration.
    </para>
    <para>
     After editing your configuration, click <guimenu>OK</guimenu> to save
     your settings.
    </para>
    <sect4>
     <title>Starting the Server</title>
     <para>
      In the <guimenu>Start Up</guimenu> tab, configure the start of the
      Samba server. To start the service every time your system boots,
      select <guimenu>During Boot</guimenu>. To activate manual start,
      choose <guimenu>Manually</guimenu>. More information about starting a
      Samba server is provided in <xref linkend="sec.samba.serv.start"/>.
     </para>
     <para>
      In this tab, you can also open ports in your firewall. To do so,
      select <guimenu>Open Port in Firewall</guimenu>. If you have multiple
      network interfaces, select the network interface for Samba services by
      clicking <guimenu>Firewall Details</guimenu>, selecting the
      interfaces, and clicking <guimenu>OK</guimenu>.
     </para>
<!--
      <figure id="fig.yast2.samba.startup">
      <title>Samba Configuration&mdash;Start
      Up</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_startup.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_startup.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>-->
    </sect4>
    <sect4>
     <title>Shares</title>
     <para>
      In the <guimenu>Shares</guimenu> tab, determine the Samba shares to
      activate. There are some predefined shares, like homes and printers.
      Use <guimenu>Toggle Status</guimenu> to switch between
      <guimenu>Active</guimenu> and <guimenu>Inactive</guimenu>. Click
      <guimenu>Add</guimenu> to add new shares and <guimenu>Delete</guimenu>
      to delete the selected share.
     </para>
<!-- <figure id="fig.yast2.samba.shares">
      <title>Samba Configuration&mdash;Shares</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_shares.png" width="70%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_shares.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>
      -->
     <para>
      <guimenu>Allow Users to Share Their Directories</guimenu> enables
      members of the group in <guimenu>Permitted Group</guimenu> to share
      directories they own with other users. For example,
      <systemitem>users</systemitem> for a local scope or
      <systemitem>DOMAIN\Users</systemitem> for a domain scope. The user
      also must make sure that the file system permissions allow access.
      With <guimenu>Maximum Number of Shares</guimenu>, limit the total
      amount of shares that may be created. To permit access to user shares
      without authentication, enable <guimenu>Allow Guest Access</guimenu>.
<!-- Bug 579993 is this option gone? -->
     </para>
    </sect4>
    <sect4>
     <title>Identity</title>
     <para>
      In the <guimenu>Identity</guimenu> tab, you can determine the domain
      with which the host is associated (<guimenu>Base Settings</guimenu>)
      and whether to use an alternative hostname in the network
      (<guimenu>NetBIOS Hostname</guimenu>).
<!--
   [x] Retrieve WINS server via DHCP
   [ ] Use WINS for Hostname Resolution
-->
      It is also possible to use Microsoft Windows Internet Name Service
      (WINS) for name resolution. In this case, activate <guimenu>Use WINS
      for Hostname Resolution</guimenu> and decide whether to
      <guimenu>Retrieve WINS server via DHCP</guimenu>. To set expert global
      settings or set a user authentication source,
      <phrase
      os="sles">for example LDAP instead of TDB database,
      </phrase>click <guimenu>Advanced Settings</guimenu>.
<!-- FIXME: check, whether
           https://bugzilla.novell.com/show_bug.cgi?id=580102 causes GUI
           changes. 2010-02-16, ke
      -->
     </para>
<!--<figure id="fig.yast2.samba.names">
      <title>Samba
      Configuration&mdash;Identity</title>
      <mediaobject>
      <imageobject role="fo">
      <imagedata fileref="yast2_samba_names.png" width="75%" format="PNG"/>
     </imageobject>
      <imageobject role="html">
      <imagedata fileref="yast2_samba_names.png" width="75%" format="PNG"/>
     </imageobject>
     </mediaobject>
     </figure>
      -->
    </sect4>
    <sect4>
     <title>Trusted Domains</title>
     <para>
      To enable users from other domains to access your domain, make the
      appropriate settings in the <guimenu>Trusted Domains</guimenu> tab. To
      add a new domain, click <guimenu>Add</guimenu>. To remove the selected
      domain, click <guimenu>Delete</guimenu>.
     </para>
    </sect4>
    <sect4>
     <title>LDAP Settings</title>
     <para>
      In the tab <guimenu>LDAP Settings</guimenu>, you can determine the
      LDAP server to use for authentication. To test the connection to your
      LDAP server, click <guimenu>Test Connection</guimenu>. To set expert
      LDAP settings or use default values, click <guimenu>Advanced
      Settings</guimenu>.
     </para>
     <para>
      For more information about LDAP configuration, see
      <xref
      linkend="cha.security.ldap"/>.
     </para>
    </sect4>
   </sect3>
  </sect2>

  <sect2 id="sec.samba.serv.inst.swat" os="osuse;sles">
   <title>Web Administration with SWAT</title>
   <para>
    <indexterm>
    <primary>Samba</primary>
    <secondary>swat</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>samba</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>services</secondary>
    </indexterm> An alternative tool for Samba server administration is SWAT
    (Samba Web Administration Tool). It provides a simple Web interface with
    which to configure the Samba server. To use SWAT, open
    <ulink url="http://localhost:901"/> in a Web browser and log in as user
    <systemitem class="username">root</systemitem>. If you do not have a
    special Samba root account, use the system
    <systemitem class="username">root</systemitem> account.
   </para>
   <note>
    <title>Activating SWAT</title>
    <para>
     After Samba server installation, SWAT is not activated. To activate it,
     open <menuchoice><guimenu>Network Services</guimenu> <guimenu>Network
     Services (xinetd)</guimenu></menuchoice> in &yast;, enable the network
     services configuration, select <guimenu>swat</guimenu> from the table,
     and click <guimenu>Toggle Status (On or Off)</guimenu>.
    </para>
   </note>
  </sect2>

  <sect2 id="sec.samba.serv.inst.manual" os="osuse;sles">
   <title>Configuring the Server Manually</title>
   <para>
    <indexterm>
    <primary>Samba</primary>
    <secondary>configuring</secondary>
    </indexterm> <indexterm>
    <primary>configuring</primary>
    <secondary>Samba</secondary>
    </indexterm> <indexterm>
    <primary>configuration files</primary>
    <secondary>smb.conf</secondary>
    </indexterm> If you intend to use Samba as a server, install
    <systemitem
    class="resource">samba</systemitem>. The main
    configuration file of Samba is <filename>/etc/samba/smb.conf</filename>.
    This file can be divided into two logical parts. The
    <literal>[global]</literal> section contains the central and global
    settings. The <literal>[share]</literal> sections contain the individual
    file and printer shares. By means of this approach, details regarding
    the shares can be set differently or globally in the
    <literal>[global]</literal> section, which enhances the structural
    transparency of the configuration file.
   </para>
   <sect3 id="sec.samba.smb.conf.Erlaeuterung">
    <title>The global Section</title>
    <para>
     The following parameters of the <literal>[global]</literal> section
     need some adjustment to match the requirements of your network setup so
     other machines can access your Samba server via SMB in a Windows
     environment.
    </para>
    <remark>ke: Important entries missing?</remark>
    <variablelist>
     <varlistentry>
      <term><literal>workgroup = TUX-NET</literal>
      </term>
      <listitem>
       <para>
        This line assigns the Samba server to a workgroup. Replace
        <literal>TUX-NET</literal> with an appropriate workgroup of your
        networking environment. Your Samba server appears under its DNS name
        unless this name has been assigned to some other machine in the
        network. If the DNS name is not available, set the server name using
        <literal>netbiosname=<replaceable>MYNAME</replaceable></literal>.
        For more details about this parameter, see the
        <systemitem>smb.conf</systemitem> man page.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>os level = 20</literal>
      </term>
      <listitem>
       <para>
        This parameter triggers whether your Samba server tries to become
        LMB (local master browser) for its workgroup. With the Samba 3
        release series, it is seldom necessary to override the default
        setting (<literal>20</literal>). Choose a very low value such as
        <literal>2</literal> to spare the existing Windows network from any
        disturbances caused by a misconfigured Samba server. More
        information about this important topic can be found in the Network
        Browsing chapter of the Samba 3 Howto; for more information on the
        Samba 3 Howto, see <xref
        linkend="sec.samba.info" />.
       </para>
       <para>
        If no other SMB server is present in your network (such as a Windows
        2000 server) and you want the Samba server to keep a list of all
        systems present in the local environment, set the <literal>os
        level</literal> to a higher value (for example,
        <literal>65</literal>). Your Samba server is then chosen as LMB for
        your local network.
       </para>
       <para>
        When changing this setting, consider carefully how this could affect
        an existing Windows network environment. First test the changes in
        an isolated network or at a noncritical time of day.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><literal>wins support</literal> and <literal>wins server</literal>
      </term>
      <listitem>
       <para>
        To integrate your Samba server into an existing Windows network with
        an active WINS server, enable the <option>wins server</option>
        option and set its value to the IP address of that WINS server.
       </para>
       <para>
        If your Windows machines are connected to separate subnets and need
        to still be aware of each other, you need to set up a WINS server.
        To turn a Samba server into such a WINS server, set the option
        <literal>wins support = Yes</literal>. Make sure that only one Samba
        server of the network has this setting enabled. The options
        <literal>wins server</literal> and <literal>wins support</literal>
        must never be enabled at the same time in your
        <filename>smb.conf</filename> file.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="sec.samba.smb.conf.shares">
    <title>Shares</title><indexterm>
    <primary>Samba</primary>
    <secondary>shares</secondary></indexterm>
    <para>
     The following examples illustrate how a CD-ROM drive and the user
     directories (<literal>homes</literal>) are made available to the SMB
     clients.
    </para>
    <variablelist>
     <varlistentry>
      <term>[cdrom]</term>
      <listitem>
       <para>
        To avoid having the CD-ROM drive accidentally made available, these
        lines are deactivated with comment marks (semicolons in this case).
        Remove the semicolons in the first column to share the CD-ROM drive
        with Samba.
       </para>
       <example id="dat.cd.rom">
        <title>A CD-ROM Share (deactivated)</title>
<screen>;[cdrom]
;       comment = Linux CD-ROM
;       path = /media/cdrom
;       locking = No</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term><option>[cdrom]</option> and <option>comment</option>
         </term>
         <listitem>
          <para>
           The <literal>[cdrom]</literal> section entry is the name of the
           share that can be seen by all SMB clients on the network. An
           additional <literal>comment</literal> can be added to further
           describe the share.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>path = /media/cdrom</option>
         </term>
         <listitem>
          <para>
           <option>path</option> exports the directory
           <filename>/media/cdrom</filename>.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
       <para>
        By means of a very restrictive default configuration, this kind of
        share is only made available to the users present on this system. If
        this share should be made available to everybody, add a line
        <literal>guest ok = yes</literal> to the configuration. This setting
        gives read permissions to anyone on the network. It is recommended
        to handle this parameter with great care. This applies even more to
        the use of this parameter in the <literal>[global]</literal>
        section.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>[homes]</option>
      </term>
      <listitem>
       <para>
        The <option>[homes]</option> share is of special importance here. If
        the user has a valid account and password for the Linux file server
        and his own home directory, he can be connected to it.
       </para>
       <example id="dat.homes.frei">
        <title>[homes] Share</title>
<screen>[homes]
	comment = Home Directories
	valid users = %S
	browseable = No
	read only = No
	create mask = 0640
	directory mask = 0750</screen>
       </example>
       <variablelist>
        <varlistentry>
         <term>[homes]</term>
         <listitem>
          <para>
           As long as there is no other share using the share name of the
           user connecting to the SMB server, a share is dynamically
           generated using the <literal>[homes]</literal> share directives.
           The resulting name of the share is the username.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>valid users = %S</option>
         </term>
         <listitem>
          <para>
           <literal>%S</literal> is replaced with the concrete name of the
           share as soon as a connection has been successfully established.
           For a <option>[homes]</option> share, this is always the
           username. As a consequence, access rights to a user's share are
           restricted exclusively to that user.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>browseable = No</option>
         </term>
         <listitem>
          <para>
           This setting makes the share invisible in the network
           environment.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>read only = No</option>
         </term>
         <listitem>
          <para>
           By default, Samba prohibits write access to any exported share by
           means of the <literal>read only = Yes</literal> parameter. To
           make a share writable, set the value <literal>read only =
           No</literal>, which is synonymous with <literal>writable =
           Yes</literal>.
          </para>
         </listitem>
        </varlistentry>
        <varlistentry>
         <term><option>create mask = 0640</option>
         </term>
         <listitem>
          <para>
           Systems that are not based on MS Windows NT do not understand the
           concept of UNIX permissions, so they cannot assign permissions
           when creating a file. The parameter <literal>create
           mask</literal> defines the access permissions assigned to newly
           created files. This only applies to writable shares. In effect,
           this setting means the owner has read and write permissions and
           the members of the owner's primary group have read permissions.
           <option>valid users = %S</option> prevents read access even if
           the group has read permissions. For the group to have read or
           write access, deactivate the line <option>valid users =
           %S</option>.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect3>
   <sect3 id="sec.samba.rechte">
    <title>Security Levels</title><indexterm id="idx.Samba_security" class="startofrange">
    <primary>Samba</primary>
    <secondary>security</secondary></indexterm><indexterm>
    <primary>security</primary>
    <secondary>Samba</secondary></indexterm><indexterm>
    <primary>Samba</primary>
    <secondary>permissions</secondary></indexterm>
    <remark>ke: what's up with "ads"?
</remark>
    <para>
     To improve security, each share access can be protected with a
     password. SMB offers the following ways of checking permissions:
    </para>
    <variablelist>
     <varlistentry>
      <term>Share Level Security (<literal>security = share</literal>)</term>
      <listitem>
       <para>
        A password is firmly assigned to a share. Everyone who knows this
        password has access to that share.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>User Level Security (<literal>security = user</literal>)</term>
      <listitem>
       <para>
        This variant introduces the concept of the user to SMB. Each user
        must register with the server with his or her own password. After
        registration, the server can grant access to individual exported
        shares dependent on usernames.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Server Level Security (<literal>security = server</literal>)</term>
      <listitem>
       <para>
        To its clients, Samba pretends to be working in user level mode.
        However, it passes all password queries to another user level mode
        server, which takes care of authentication. This setting requires
        the additional <option>password server</option> parameter.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>ADS Level Security (<literal>security = ADS</literal>)</term>
      <listitem>
       <para>
        In this mode, Samba will act as a domain member in an Active
        Directory environment. To operate in this mode, the machine running
        Samba needs Kerberos installed and configured. You must join the
        machine using Samba to the ADS realm. This can be done using the
        &yast; <guimenu>Windows Domain Membership</guimenu> module.
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>Domain Level Security (<literal>security = domain</literal>)</term>
      <listitem>
       <para>
        This mode will only work correctly if the machine has been joined
        into a Windows NT Domain. Samba will try to validate username and
        password by passing it to a Windows NT Primary or Backup Domain
        Controller. The same way as a Windows NT Server would do. It expects
        the encrypted passwords parameter to be set to
        <literal>yes</literal>.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     The selection of share, user, server, or domain level security applies
     to the entire server. It is not possible to offer individual shares of
     a server configuration with share level security and others with user
     level security. However, you can run a separate Samba server for each
     configured IP address on a system.
    </para>
    <para>
     More information about this subject can be found in the Samba 3 HOWTO.
     For multiple servers on one system, pay attention to the options
     <option>interfaces</option> and <option>bind interfaces only</option>.
    </para><indexterm class="endofrange"
     startref="idx.Samba_security"/>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.client.inst">
  <title>Configuring Clients</title><indexterm>

  <primary>Samba</primary>

  <secondary>clients</secondary></indexterm>

  <para>
   Clients can only access the Samba server via TCP/IP. NetBEUI and NetBIOS
   via IPX cannot be used with Samba.
  </para>

  <sect2 id="sec.samba.client.inst.yast">
   <title>Configuring a Samba Client with &yast;</title><indexterm>
   <primary>YaST</primary>
   <secondary>Samba</secondary>
   <tertiary>clients</tertiary></indexterm><indexterm>
   <primary>Samba</primary>
   <secondary>clients</secondary></indexterm><indexterm>
   <primary>configuring</primary>
   <secondary>Samba</secondary>
   <tertiary>clients</tertiary></indexterm>
   <para>
    Configure a Samba client to access resources (files or printers) on the
    Samba or Windows server. Enter the NT or Active Directory domain or
    workgroup in the dialog <menuchoice> <guimenu>Network Services</guimenu>
    <guimenu>Windows Domain Membership</guimenu></menuchoice>. If you
    activate <guimenu>Also Use SMB Information for Linux
    Authentication</guimenu>, the user authentication runs over the Samba,
    NT or Kerberos server.
   </para>
<!-- FIXME: checkit 2010-09-02, ke -->
   <para>
    Click <guimenu>Expert Settings</guimenu> for advanced configuration
    options. For example, use the <guimenu>Mount Server
    Directories</guimenu> table to enable mounting server home directory
    automatically with authentication. This way users will be able to access
    their home directories when hosted on CIFS. For details, see the the
    <systemitem>pam_mount</systemitem> man page.
   </para>
   <para>
    After completing all settings, confirm the dialog to finish the
    configuration.
   </para>
  </sect2>
 </sect1>
 <sect1 id="sec.samba.anmeld.serv">
  <title>Samba as Login Server</title><indexterm>

  <primary>Samba</primary>

  <secondary>login</secondary></indexterm>

  <para>
   In networks where predominantly Windows clients are found, it is often
   preferable that users may only register with a valid account and
   password. In a Windows-based network, this task is handled by a primary
   domain controller (PDC). You can use a Windows NT server configured as
   PDC, but this task can also be done with a Samba server. The entries that
   must be made in the <literal>[global]</literal> section of
   <filename>smb.conf</filename> are shown in
   <xref linkend="dat.samba.smb.conf.dom"/>.
  </para>

  <example id="dat.samba.smb.conf.dom">
   <title>Global Section in smb.conf</title>
<screen>[global]
    workgroup = TUX-NET
    domain logons = Yes
    domain master = Yes</screen>
  </example>

  <para>
   If encrypted passwords are used for verification purposes the Samba
   server must be able to handle these. The entry <literal>encrypt passwords
   = yes</literal> in the <literal>[global]</literal> section enables this
   (with Samba version 3, this is now the default). In addition, it is
   necessary to prepare user accounts and passwords in an encryption format
   that conforms with Windows. Do this with the command <command>smbpasswd
   <option>-a name</option></command>. Create the domain account for the
   computers, required by the Windows domain concept, with the following
   commands:
  </para>

<screen>useradd hostname\$
smbpasswd -a -m hostname</screen><indexterm>

  <primary>commands</primary>

  <secondary>smbpasswd</secondary></indexterm>

  <para>
   With the <command>useradd</command> command, a dollar sign is added. The
   command <command>smbpasswd</command> inserts this automatically when the
   parameter <option>-m</option> is used. The commented configuration
   example
   (<filename>/usr/share/doc/packages/samba/examples/smb.conf.SUSE</filename>)
   contains settings that automate this task.
  </para>

<screen>add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$
     </screen>

  <para>
   To make sure that Samba can execute this script correctly, choose a Samba
   user with the required administrator permissions and add it to the
   <systemitem class="groupname">ntadmin</systemitem> group. Then all users
   belonging to this Linux group can be assigned <literal>Domain
   Admin</literal> status with the command:
  </para>

<screen>net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</screen>

  <para>
   For more information about this topic, see Chapter 12 of the Samba 3
   HOWTO, found in
   <filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename>.
  </para>
 </sect1>
 <sect1 id="sec.samba.adnet" os="sles">
  <title>Samba Server in the Network with Active Directory</title>

  <para>
   If you run Linux servers and Windows servers together, you can build two
   independent authentication systems and networks or connect servers to one
   network with one central authentication system. Because Samba can
   cooperate with an active directory domain, you can join your &sls; to
   Active Directory (AD).
  </para>

  <para>
   Join an existing AD domain during installation or by later activating SMB
   user authentication with &yast; in the installed system. Domain join
   during installation is covered in
   <phrase os="osuse;sled"><xref linkend="sec.i.yast2.user"/></phrase>
   <phrase os="sles"><xref linkend="sec.i.yast2.conf.manual.user_auth"/></phrase>.
  </para>

  <para>
   To join an AD domain in a running system, proceed as follows:
  </para>

  <procedure>
   <step>
    <para>
     Log in as &rootuser; and start &yast;.
    </para>
   </step>
   <step>
    <para>
     Start <menuchoice> <guimenu>Network Services</guimenu> <guimenu>Windows
     Domain Membership</guimenu> </menuchoice>.
    </para>
   </step>
   <step>
    <para>
     Enter the domain to join at <guimenu>Domain or Workgroup</guimenu> in
     the <guimenu>Windows Domain Membership</guimenu> screen.
    </para>
    <figure>
     <title>Determining Windows Domain Membership</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_sambaclient.png" width="75%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Check <guimenu>Also Use SMB Information for Linux
     Authentication</guimenu> to use the SMB source for Linux authentication
     on your &sls;.
    </para>
   </step>
   <step>
    <para>
     Click <guimenu>OK</guimenu> and confirm the domain join when prompted
     for it.
    </para>
   </step>
   <step>
    <para>
     Provide the password for the Windows Administrator on the AD server and
     click <guimenu>OK</guimenu>.
    </para>
<!--
    <figure>
     <title>Providing Administrator Credentials</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="ad_join1.png" width="30%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="ad_join1.png" width="30%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
    -->
    <para>
     Your server is now set up to pull in all authentication data from the
     Active Directory domain controller.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 id="sec.samba.info">
  <title>For More Information</title>

  <para>
   Detailed Samba information is available in the digital documentation.
   Enter <command>apropos</command> <option>samba</option> at the command
   line to display some manual pages or just browse the
   <filename>/usr/share/doc/packages/samba</filename> directory if Samba
   documentation is installed for more online documentation and examples.
   Find a commented example configuration
   (<filename>smb.conf.SUSE</filename>) in the <filename>examples</filename>
   subdirectory. <indexterm>
   <primary>configuration files</primary>
   <secondary>smb.conf</secondary>
   </indexterm>
  </para>

  <para>
   The Samba 3 HOWTO provided by the Samba team includes a section about
   troubleshooting. In addition to that, Part V of the document provides a
   step-by-step guide to checking your configuration. You can find Samba 3
   HOWTO in
   <filename>/usr/share/doc/packages/samba/Samba3-HOWTO.pdf</filename> after
   installing the package <systemitem>samba-doc</systemitem>.
  </para>

  <para os="osuse">
   Also read the Samba page in the openSUSE wiki at
   <ulink
   url="http://en.openSUSE.org/Samba"/>.
  </para><indexterm class="endofrange" startref="idx.Samba"/>
 </sect1>
</chapter>
